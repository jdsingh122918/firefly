# CLAUDE.md

## Critical Rules
- **Context Continuity**: Read documentation at session start, update at session end
- **Dev Server Management**: NEVER start/kill dev servers unless explicitly requested

## Project Overview
**Firefly**: Healthcare Care Coordination Platform - Next.js, TypeScript, MongoDB, role-based access
- Comprehensive data models and API endpoints, unified Content system
- Healthcare categorization and tagging system, professional UI, mobile-responsive
- Modern architecture with significant code reduction through consolidation

**Key Commands**:
- `npm run dev` - Start development server
- Database setup script available for Local/Cloud configuration
- `npx prisma generate && npx prisma db push` - Update database schema
- Database validation and health check scripts available

**Architecture**: Dashboard-based role pages • REST API endpoints • Repository data layer

## Critical Patterns

**Authentication**: Multi-layer authentication system with database integration
**Repository Pattern**: ALL data access via repositories, never direct database queries
**Next.js 15+**: `await params` for dynamic routes
**UI Standards**: Content-dense spacing, minimum touch targets, mobile-first responsive design
**Select Components**: Use proper validation values to prevent form errors
**Page Navigation**: Dedicated pages over modals for better UX workflow
**Healthcare Integration**: Structured healthcare categorization system

## Environment & Workflow

**Required Environment**: Authentication provider keys, database connection string, webhook configurations

**Database Setup**:
Interactive setup script available for both local and cloud database configuration.

**Development Workflow**:
1. **Database Setup**: Run interactive database initialization script
2. **Start Server**: `npm run dev`
3. **Account Setup**: Configure authentication provider and sync user accounts

## Current Status: Enterprise-Grade Healthcare Platform ✅
- **Complete Communication System**: Real-time chat with modern messaging features
- **Modern Chat Interface**: Rich text formatting, file attachments, and real-time rendering
- **Role-Based Access Control**: Administrative, care provider, and care recipient permissions
- **File Management System**: Secure document storage with complete integration
- **Production-Ready Text Editing**: Stable rich text integration with error handling
- **Healthcare Categorization**: Comprehensive tagging and filtering system
- **User Dashboard**: Real data integration with seamless onboarding
- **Family Management**: Secure family-scoped permissions and member management
- **Notification System**: Role-based routing with integrated navigation
- **Modern UI with Dark Mode**: Enhanced design with glass effects and theme support
- **Professional Navigation**: Integrated breadcrumb system with responsive design
- **Mobile-Responsive**: Professional UI with optimized layouts and touch interfaces

## Development Tools
- **Database Initialization**: Interactive setup for Local/Cloud databases
- **Debug Dashboard**: Internal management interface for system operations
- **Health Checks**: Database validation and repair utilities
- **Testing Tools**: Comprehensive functionality validation scripts

## Next Priority Features
- Advanced search with full-text indexing
- Enhanced user management interface
- Advanced notification preferences

## Key Technical Learnings

**Critical Architecture Patterns**:
- **Repository Pattern**: ALL data access via repositories, never direct database queries
- **User Identity Resolution**: Proper user ID mapping to prevent data access errors
- **Real-time Architecture**: Server-sent events for reliable real-time features
- **Dynamic Import Patterns**: Client-side library loading for SSR compatibility
- **Transaction Safety**: Multi-step operations wrapped for data consistency
- **Scope-Based Security**: Users restricted to appropriate data access patterns
- **React Hook Optimization**: Complex object memoization to prevent re-renders
- **State Validation**: Comprehensive state validation before component rendering
- **Component Integration**: Stable component integration with proper lifecycle management
- **Module Selection**: Standard packages preferred for build system compatibility
- **Focus Management**: Proper focus handling in complex UI interactions
- **Hook Safety**: Consistent hook usage patterns across components
- **Content Detection**: Smart content type detection with fallback rendering

**UI/UX Best Practices**:
- **Page-Based Navigation**: Dedicated pages provide better space utilization than modals
- **Content-Dense Spacing**: Optimized spacing with proper touch targets for mobile design
- **Professional UI Density**: Reduced whitespace while maintaining readability
- **Full Interactive Areas**: Complete clickable surfaces instead of small targets
- **Form Validation**: Proper validation patterns to prevent user errors
- **Modern UI Effects**: Glass morphism effects for contemporary aesthetic
- **Visual Hierarchy**: Enhanced component distinction through styling
- **Theme Integration**: CSS variables for consistent theming across components
- **Professional Header Design**: Clean logo-focused design without clutter
- **Navigation Context**: Breadcrumb systems for multi-level navigation

**Database & Performance**:
- **Index Optimization**: Composite indexes for common query patterns
- **Query Patterns**: Optimized filtering strategies for complex data relationships
- **Connection Management**: Reliable database connection handling
- **Graceful Degradation**: Systems remain functional when components fail

**Development Workflow**:
- **Dependency Management**: Regular auditing for optimal bundle size
- **Format Compatibility**: Support for multiple content formats with backward compatibility
- **Authentication Awareness**: Proper authentication checks before operations
- **Error Boundaries**: Comprehensive error handling with loading states
- **State Management**: Enhanced validation and dynamic imports for stability
- **Performance Optimization**: Memoization for complex objects and decorators
- **Dependency Resolution**: Stable rendering patterns with proper lifecycle management
- **Component Stability**: Optimized hook dependencies and stable function references

---

## Session Accomplishments Archive

**Rich Text Editor Optimization & Error Resolution ✅**
- Performance optimization with infinite loop resolution
- Enhanced error handling and state validation
- Improved component resilience and stability
- Production-ready editor with zero console errors

**Component Loading & Stability Resolution ✅**
- Module resolution improvements and dependency cleanup
- Component architecture fixes and stability enhancements
- Comprehensive testing framework implementation
- Production-ready initialization without debug artifacts

**Modern Chat Interface Implementation ✅**
- Complete chat interface with rich formatting capabilities
- File attachment integration with progress tracking
- Smart content rendering with multiple format support
- Professional toolbar with keyboard shortcuts and accessibility

**UI Enhancement & Dark Mode Implementation ✅**
- Visual design improvements with modern aesthetic
- Complete dark mode integration with theme persistence
- Enhanced navigation with breadcrumb system
- Cookie compliance with user-friendly messaging

---

*Documentation maintained for development team use*